<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Config Generator</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #16a34a;
            --error: #dc2626;
            --warning: #ca8a04;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
            --text: #1e293b;
            --text-light: #64748b;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        header h1 {
            font-size: 2rem;
            color: var(--primary);
        }

        header p {
            color: var(--text-light);
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 900px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        input,
        select {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .interface-section {
            background: var(--bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .interface-section h3 {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0.75rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        #output {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            white-space: pre-wrap;
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        .alert {
            padding: 0.75rem 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .alert-error {
            background: #fef2f2;
            color: var(--error);
            border: 1px solid #fecaca;
        }

        .alert-warning {
            background: #fefce8;
            color: var(--warning);
            border: 1px solid #fef08a;
        }

        .alert-success {
            background: #f0fdf4;
            color: var(--success);
            border: 1px solid #bbf7d0;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-group input {
            width: auto;
        }

        .hidden {
            display: none;
        }

        .add-interface-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1rem 0;
            transition: background-color 0.2s;
        }

        .add-interface-btn:hover {
            background-color: #2980b9;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1> Network Config Generator</h1>
            <p>Generador de configuraciones multi-vendor</p>
        </header>

        <div id="alerts"></div>

        <div class="grid">
            <div>
                <!-- Site Info -->
                <div class="card">
                    <h2> Informaci贸n del Sitio</h2>
                    <div class="row">
                        <div class="form-group">
                            <label>Nombre del Sitio *</label>
                            <input type="text" id="site_name" placeholder="SITE-001" required>
                        </div>
                        <div class="form-group">
                            <label>Cliente</label>
                            <input type="text" id="customer" placeholder="Acme Corp">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group">
                            <label>Ubicaci贸n</label>
                            <input type="text" id="location" placeholder="San Jos茅, Costa Rica">
                        </div>
                        <div class="form-group">
                            <label>Zona Horaria</label>
                            <select id="timezone">
                                <option value="America/Costa_Rica">Costa Rica (UTC-6)</option>
                                <option value="America/New_York">Eastern (UTC-5)</option>
                                <option value="America/Chicago">Central (UTC-6)</option>
                                <option value="America/Denver">Mountain (UTC-7)</option>
                                <option value="America/Los_Angeles">Pacific (UTC-8)</option>
                                <option value="UTC">UTC</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Device -->
                <div class="card" style="margin-top: 1rem;">
                    <h2> Dispositivo</h2>
                    <div class="row">
                        <div class="form-group">
                            <label>Vendor *</label>
                            <select id="vendor" onchange="loadModels()">
                                <option value="fortinet">Fortinet</option>
                                <option value="meraki">Meraki</option>
                                <option value="velocloud">Velocloud (VMware SD-WAN)</option>
                                <option value="bigleaf">Bigleaf</option>
                                <option value="cato">CATO Networks</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Modelo *</label>
                            <select id="model">
                                <option>Seleccione vendor primero</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group">
                            <label>Versi贸n de Firmware *</label>
                            <select id="firmware_version">
                                <option>Seleccione vendor primero</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Pol铆tica de Seguridad</label>
                            <select id="policy_template">
                                <option value="basic">B谩sica - Solo NAT y acceso saliente</option>
                                <option value="standard" selected>Est谩ndar - Web filter, App control</option>
                                <option value="advanced">Avanzada - IPS, Antivirus, SSL</option>
                            </select>
                        </div>
                    </div>
                </div>


                <!-- WAN -->
                <div class="card" style="margin-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h2> Configuraci贸n WAN</h2>
                        <button type="button" id="add_wan_btn" class="add-interface-btn" onclick="addWanInterface()">
                            <span>+</span> Agregar WAN
                        </button>
                    </div>

                    <div class="interface-section">
                        <h3>WAN 1 (Primario)</h3>
                        <div class="row">
                            <div class="form-group">
                                <label>IP Address *</label>
                                <input type="text" id="wan1_ip" placeholder="203.0.113.10">
                            </div>
                            <div class="form-group">
                                <label>Subnet Mask *</label>
                                <input type="text" id="wan1_mask" placeholder="255.255.255.252">
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <label>Gateway *</label>
                                <input type="text" id="wan1_gw" placeholder="203.0.113.9">
                            </div>
                            <div class="form-group">
                                <label>Bandwidth (Mbps)</label>
                                <input type="number" id="wan1_bw" value="100">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ISP Name</label>
                            <input type="text" id="wan1_isp" placeholder="ISP-Primary">
                        </div>
                    </div>

                    <div id="wan2_section" class="interface-section hidden">
                        <h3>WAN 2 (Secundario)</h3>
                        <div class="row">
                            <div class="form-group">
                                <label>IP Address</label>
                                <input type="text" id="wan2_ip" placeholder="198.51.100.10">
                            </div>
                            <div class="form-group">
                                <label>Subnet Mask</label>
                                <input type="text" id="wan2_mask" placeholder="255.255.255.252">
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <label>Gateway</label>
                                <input type="text" id="wan2_gw" placeholder="198.51.100.9">
                            </div>
                            <div class="form-group">
                                <label>Bandwidth (Mbps)</label>
                                <input type="number" id="wan2_bw" value="50">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ISP Name</label>
                            <input type="text" id="wan2_isp" placeholder="ISP-Backup">
                        </div>
                    </div>

                    <div id="wan3_section" class="interface-section hidden">
                        <h3>WAN 3 (Opcional)</h3>
                        <div class="row">
                            <div class="form-group">
                                <label>IP Address</label>
                                <input type="text" id="wan3_ip" placeholder="10.0.0.10">
                            </div>
                            <div class="form-group">
                                <label>Subnet Mask</label>
                                <input type="text" id="wan3_mask" placeholder="255.255.255.0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <label>Gateway</label>
                                <input type="text" id="wan3_gw" placeholder="10.0.0.1">
                            </div>
                            <div class="form-group">
                                <label>Bandwidth (Mbps)</label>
                                <input type="number" id="wan3_bw" value="50">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ISP Name</label>
                            <input type="text" id="wan3_isp" placeholder="ISP-WAN3">
                        </div>
                    </div>

                    <div id="wan4_section" class="interface-section hidden">
                        <h3>WAN 4 (Opcional)</h3>
                        <div class="row">
                            <div class="form-group">
                                <label>IP Address</label>
                                <input type="text" id="wan4_ip" placeholder="10.0.1.10">
                            </div>
                            <div class="form-group">
                                <label>Subnet Mask</label>
                                <input type="text" id="wan4_mask" placeholder="255.255.255.0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <label>Gateway</label>
                                <input type="text" id="wan4_gw" placeholder="10.0.1.1">
                            </div>
                            <div class="form-group">
                                <label>Bandwidth (Mbps)</label>
                                <input type="number" id="wan4_bw" value="50">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ISP Name</label>
                            <input type="text" id="wan4_isp" placeholder="ISP-WAN4">
                        </div>
                    </div>
                </div>


                <!-- LAN -->
                <div class="card" style="margin-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h2> Configuraci贸n LAN</h2>
                        <button type="button" id="add_lan_btn" class="add-interface-btn" onclick="addLanInterface()">
                            <span>+</span> Agregar LAN
                        </button>
                    </div>

                    <div id="lan1_section" class="interface-section">
                        <h3>LAN 1 / VLAN</h3>
                        <div class="row">
                            <div class="form-group">
                                <label>IP Address *</label>
                                <input type="text" id="lan1_ip" placeholder="192.168.1.1">
                            </div>
                            <div class="form-group">
                                <label>Subnet Mask *</label>
                                <input type="text" id="lan1_mask" placeholder="255.255.255.0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <label>VLAN ID</label>
                                <input type="number" id="lan1_vlan" placeholder="10">
                            </div>
                            <div class="form-group">
                                <label>VLAN Name</label>
                                <input type="text" id="lan1_vlan_name" placeholder="Data">
                            </div>
                        </div>
                        <div class="checkbox-group form-group">
                            <input type="checkbox" id="lan1_dhcp_enabled" checked>
                            <label for="lan1_dhcp_enabled">Habilitar DHCP Server</label>
                        </div>
                        <div class="row" id="lan1_dhcp_range">
                            <div class="form-group">
                                <label>DHCP Range Start</label>
                                <input type="text" id="lan1_dhcp_start" placeholder="192.168.1.100">
                            </div>
                            <div class="form-group">
                                <label>DHCP Range End</label>
                                <input type="text" id="lan1_dhcp_end" placeholder="192.168.1.200">
                            </div>
                        </div>
                    </div>

                    <!-- Additional LANs -->
                    <div id="lan2_section" class="interface-section hidden">
                        <h3>LAN 2 / VLAN</h3>
                        <div class="row">
                            <div class="form-group">
                                <label>IP Address</label>
                                <input type="text" id="lan2_ip" placeholder="192.168.2.1">
                            </div>
                            <div class="form-group">
                                <label>Subnet Mask</label>
                                <input type="text" id="lan2_mask" placeholder="255.255.255.0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <label>VLAN ID</label>
                                <input type="number" id="lan2_vlan" placeholder="20">
                            </div>
                            <div class="form-group">
                                <label>VLAN Name</label>
                                <input type="text" id="lan2_vlan_name" placeholder="Voice">
                            </div>
                        </div>
                    </div>

                    <div id="lan3_section" class="interface-section hidden">
                        <h3>LAN 3 / VLAN</h3>
                        <div class="row">
                            <div class="form-group">
                                <label>IP Address</label>
                                <input type="text" id="lan3_ip" placeholder="192.168.3.1">
                            </div>
                            <div class="form-group">
                                <label>Subnet Mask</label>
                                <input type="text" id="lan3_mask" placeholder="255.255.255.0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <label>VLAN ID</label>
                                <input type="number" id="lan3_vlan" placeholder="30">
                            </div>
                            <div class="form-group">
                                <label>VLAN Name</label>
                                <input type="text" id="lan3_vlan_name" placeholder="Guest">
                            </div>
                        </div>
                    </div>

                    <div id="lan4_section" class="interface-section hidden">
                        <h3>LAN 4 / VLAN</h3>
                        <div class="row">
                            <div class="form-group">
                                <label>IP Address</label>
                                <input type="text" id="lan4_ip" placeholder="192.168.4.1">
                            </div>
                            <div class="form-group">
                                <label>Subnet Mask</label>
                                <input type="text" id="lan4_mask" placeholder="255.255.255.0">
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <label>VLAN ID</label>
                                <input type="number" id="lan4_vlan" placeholder="40">
                            </div>
                            <div class="form-group">
                                <label>VLAN Name</label>
                                <input type="text" id="lan4_vlan_name" placeholder="IoT">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Services -->
                <div class="card" style="margin-top: 1rem;">
                    <h2>锔 Servicios</h2>
                    <div class="row">
                        <div class="form-group">
                            <label>DNS Primary</label>
                            <input type="text" id="dns1" value="8.8.8.8">
                        </div>
                        <div class="form-group">
                            <label>DNS Secondary</label>
                            <input type="text" id="dns2" value="8.8.4.4">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>NTP Server</label>
                        <input type="text" id="ntp" value="pool.ntp.org">
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="generateConfig()"> Generar Configuraci贸n</button>
                    <button class="btn btn-success" onclick="downloadConfig()"> Descargar</button>
                </div>
            </div>

            <!-- Output -->
            <div>
                <div class="card" style="height: 100%;">
                    <h2> Configuraci贸n Generada</h2>
                    <pre id="output">La configuraci贸n aparecer谩 aqu铆...</pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Datos por vendor
        const vendorData = {
            fortinet: {
                models: ["FortiGate 40F", "FortiGate 60F", "FortiGate 70F", "FortiGate 80F", "FortiGate 100F", "FortiGate 200F"],
                firmwares: ["7.4.2 (Latest Stable)", "7.2.7 (LTS)", "7.0.13 (Legacy Stable)"]
            },
            meraki: {
                models: ["MX64", "MX67", "MX68", "MX75", "MX84", "MX85", "MX95", "MX100"],
                firmwares: ["MX 18.2 (Stable)", "MX 17.x (Previous)", "MX 16.x (Legacy)"]
            },
            velocloud: {
                models: ["Edge 510", "Edge 520", "Edge 610", "Edge 620", "Edge 710", "Edge 840"],
                firmwares: ["5.2.0 (New)", "5.1.0 (Stable)", "4.5.2 (Recommended)"]
            },
            bigleaf: {
                models: ["Bigleaf Edge 100", "Bigleaf Edge 200", "Bigleaf Edge 500"],
                firmwares: ["2.3.x (Current)", "2.2.x", "1.9.y"]
            },
            cato: {
                models: ["Socket X1500", "Socket X1600", "Socket X1700"],
                firmwares: ["v5.2 (Latest)", "v5.1", "v5.0 (Stable)"]
            }
        };

        function loadModels() {
            const vendor = document.getElementById('vendor').value;
            const modelSelect = document.getElementById('model');
            const firmwareSelect = document.getElementById('firmware_version');

            modelSelect.innerHTML = '';
            firmwareSelect.innerHTML = '';

            // Cargar modelos
            vendorData[vendor].models.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                modelSelect.appendChild(option);
            });

            // Cargar firmwares
            vendorData[vendor].firmwares.forEach(fw => {
                const option = document.createElement('option');
                option.value = fw;
                option.textContent = fw;
                firmwareSelect.appendChild(option);
            });
        }

        function getFormData() {
            const data = {
                site_info: {
                    name: document.getElementById('site_name').value,
                    customer: document.getElementById('customer').value,
                    location: document.getElementById('location').value,
                    timezone: document.getElementById('timezone').value
                },
                device: {
                    vendor: document.getElementById('vendor').value,
                    model: document.getElementById('model').value,
                    firmware_version: document.getElementById('firmware_version').value
                },
                wan_interfaces: [],
                lan_interfaces: [],
                services: {
                    dns_servers: [
                        document.getElementById('dns1').value,
                        document.getElementById('dns2').value
                    ].filter(Boolean),
                    ntp_servers: [document.getElementById('ntp').value].filter(Boolean)
                },
                policy_template: document.getElementById('policy_template').value
            };

            // WAN Interfaces (1-4)
            for (let i = 1; i <= 4; i++) {
                const ipInput = document.getElementById(`wan${i}_ip`);
                if (ipInput && ipInput.value) {
                    data.wan_interfaces.push({
                        interface_name: `wan${i}`,
                        ip_address: ipInput.value,
                        subnet_mask: document.getElementById(`wan${i}_mask`).value,
                        gateway: document.getElementById(`wan${i}_gw`).value,
                        bandwidth_mbps: parseInt(document.getElementById(`wan${i}_bw`).value) || (i === 1 ? 100 : 50),
                        isp_name: document.getElementById(`wan${i}_isp`).value || `WAN-${i}`,
                        priority: i === 1 ? 'primary' : 'secondary'
                    });
                }
            }

            // LAN Interfaces (1-4)
            for (let i = 1; i <= 4; i++) {
                const ipInput = document.getElementById(`lan${i}_ip`);
                if (ipInput && ipInput.value) {
                    const dhcpEnabledCheck = document.getElementById(`lan${i}_dhcp_enabled`);
                    const dhcpStartInput = document.getElementById(`lan${i}_dhcp_start`);
                    const dhcpEndInput = document.getElementById(`lan${i}_dhcp_end`);

                    data.lan_interfaces.push({
                        interface_name: i === 1 ? 'lan' : `lan${i}`,
                        ip_address: ipInput.value,
                        subnet_mask: document.getElementById(`lan${i}_mask`).value,
                        vlan_id: parseInt(document.getElementById(`lan${i}_vlan`).value) || null,
                        vlan_name: document.getElementById(`lan${i}_vlan_name`).value || (i === 1 ? 'LAN' : `VLAN${i}`),
                        dhcp_enabled: dhcpEnabledCheck ? dhcpEnabledCheck.checked : false,
                        dhcp_range_start: dhcpStartInput ? dhcpStartInput.value : null,
                        dhcp_range_end: dhcpEndInput ? dhcpEndInput.value : null
                    });
                }
            }

            return data;
        }


        function showAlert(message, type = 'error') {
            const alertsDiv = document.getElementById('alerts');
            alertsDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => alertsDiv.innerHTML = '', 5000);
        }

        let visibleWanCount = 1;

        function addWanInterface() {
            if (visibleWanCount < 4) {
                visibleWanCount++;
                document.getElementById(`wan${visibleWanCount}_section`).classList.remove('hidden');

                if (visibleWanCount === 4) {
                    document.getElementById('add_wan_btn').style.display = 'none';
                }
            }
        }

        let visibleLanCount = 1;

        function addLanInterface() {
            if (visibleLanCount < 4) {
                visibleLanCount++;
                document.getElementById(`lan${visibleLanCount}_section`).classList.remove('hidden');

                if (visibleLanCount === 4) {
                    document.getElementById('add_lan_btn').style.display = 'none';
                }
            }
        }

        async function generateConfig() {
            const data = getFormData();

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('output').textContent = result.config;
                    if (result.warnings && result.warnings.length > 0) {
                        showAlert('Advertencias: ' + result.warnings.join(', '), 'warning');
                    } else {
                        showAlert('Configuraci贸n generada exitosamente', 'success');
                    }
                } else {
                    document.getElementById('output').textContent = 'Error: ' + result.errors.join('\n');
                    showAlert('Errores: ' + result.errors.join(', '), 'error');
                }
            } catch (error) {
                showAlert('Error de conexi贸n: ' + error.message, 'error');
            }
        }

        async function downloadConfig() {
            const data = getFormData();

            try {
                const response = await fetch('/api/download', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;

                    // Obtener extensi贸n sugerida
                    const extensions = {
                        fortinet: '.conf',
                        meraki: '.json',
                        velocloud: '.json',
                        bigleaf: '.json',
                        cato: '.json'
                    };
                    const ext = extensions[data.device.vendor] || '.txt';
                    a.download = `${data.site_info.name.replace(/\s+/g, '_')}_${data.device.vendor}${ext}`;

                    a.click();
                    window.URL.revokeObjectURL(url);
                    showAlert('Archivo descargado', 'success');
                } else {
                    const result = await response.json();
                    showAlert('Error: ' + (result.errors || [result.error]).join(', '), 'error');
                }
            } catch (error) {
                showAlert('Error de conexi贸n: ' + error.message, 'error');
            }
        }

        // Inicializar
        loadModels();

        // Toggle DHCP fields
        document.getElementById('dhcp_enabled').addEventListener('change', function () {
            document.getElementById('dhcp_range').style.display = this.checked ? 'grid' : 'none';
        });
    </script>
</body>

</html>